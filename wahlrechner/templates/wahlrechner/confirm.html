{% extends 'wahlrechner/base.html' %}
{% load wahlrechner_extras %}

{% block title %}Gewichtung der Thesen{% endblock %}

{% block sidebar %}
    {% include "wahlrechner/sidebar.html" with icon_default="skip" url_template="these" %}
{% endblock %}

{% block content %}
    
    <div class="content">
        <h1>Gewichtung der Thesen</h1>
        <p>Wähle die Thesen aus, die dir wichtig sind. Diese Thesen werden in der Berechnung doppelt gewichtet.</p>
    </div>

    <form method="get" action="{% url 'results' %}">

        <div class="card p-6 lg:p-9">

            {% for these in these_list %}

                {% with status=request.GET|get_param_value:these.pk %}

                    {% comment %}
                    Erstellt ein versteckten Input für jede These mit der Position des Nutzers, damit das Formular
                    diese in Form von GET-Parametern an die Ergebnis-Seite übergibt. Die GET-Parameter werden also
                    nach dem Abschicken dieses Formulars komplett neu generiert.

                    Thesen, die nicht beantwortet wurden, werden automatisch als Übersprungen makiert.
                    {% endcomment %}
                    <input type="hidden" name="{{ these.pk }}"
                           value="{% if status %}{{ status }}{% else %}s{% endif %}">

                    {# Beantwortete und nicht-übersprungene Thesen sollen priorisiert werden können #}
                    {% if status and status != 's' %}

                        {# Das Label besteht aus der Checkbox, dem Titel der These, Position und Beschreibung #}
                        <label class="favbox group" for="p{{ these.pk }}">

                            {# Eigentliche Checkbox (oranges Kästchen) #}
                            <div class="favbox">

                                <input type="checkbox"
                                       id="p{{ these.pk }}"
                                       name="p{{ these.pk }}"
                                       value=1

                                        {# Checked, wenn entsprechender GET-Parameter vorhanden #}
                                        {% with "p"|addstr:these.pk as key %}
                                            {% if request.GET|get_param_value:key %}
                                       checked
                                            {% endif %}
                                        {% endwith %}
                                >

                                {# Weißer Stern in der Checkbox #}
                                {% alias "0 0 20 20" as vb %}
                                {% alias "hidden w-4 h-4 fill-current" as css %}
                                {% include "snippets/icon.html" with icon="fav" color="white" viewbox=vb classes=css %}

                            </div>

                            <div class="text-left">

                                {# Titel der These und Icon für die Position des Nutzers #}
                                <div class="text-gray-700 select-none dark:text-gray-200">
                                    {{ these.these_keyword }}
                                    {% include "snippets/icon.html" with icon=status %}
                                </div>

                                {# Beschreibung der These #}
                                <div class="text-sm text-gray-500 dark:text-gray-400">{{ these.these_text }}</div>

                            </div>

                        </label>

                    {% endif %}

                {% endwith %}

            {% endfor %}

        </div>

        <div class="btn-row">
            {% alias "Antworten bearbeiten" as text %}
            {% include "snippets/btn.html" with text=text url="these" get=payload_previous icon="edit" pos="l" %}

            {% alias "Ergebnisse anzeigen" as text %}
            {% include "snippets/btn.html" with text=text type="submit" icon="cright" pos="r" %}
        </div>

    </form>

{% endblock %}
